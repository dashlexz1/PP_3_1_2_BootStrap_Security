<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Edit user</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
</head>
<body>
<th:include th:replace="~{navbar :: navbar}"></th:include>
<div class = "container">
<h1>Admin Panel</h1>
<table class="table">
<thead class="text-center table-light">
<tr>
    <th scope="col">ID</th>
    <th scope="col">Name</th>
    <th scope="col">Salary</th>
    <th scope="col">Age</th>
    <th scope="col">Email</th>
    <th scope="col">Role</th>
    <th scope="col">Edit</th>
    <th scope="col">Delete</th>
</tr>
</thead>
<tbody class="text-center table-light">
<tr th:each="user : ${users}">
    <td th:text="${user.id}"></td>
    <td th:text="${user.name}"></td>
    <td th:text="${user.salary}"></td>
    <td th:text="${user.age}"></td>
    <td th:text="${user.username}"></td>
    <td>
        <dl th:each="role : ${user.getUserRoles()}">
        <dd th:text="${role.roleName}"></dd>
        </dl>
    </td>
    <td>
        <button type="button" class="btn btn-primary" data-toggle="modal" th:action="@{/admin/{id}/edit(id=${user.id})}" th:method="get" th:attr="data-target='#editUserModal-'+${user.id}">
            Edit
        </button>
        <form th:action="@{/admin/{id}(id=${user.id})}" th:method="post">
        <div class="modal" th:id="'editUserModal-'+${user.id}"  tabindex="-1" role="dialog" aria-labelledby="exampleModalCenteredLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Изменить пользователя</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                            <div class="alert alert-secondary" role="alert">
                                <th:block th:value="${user.id}" th:text ="${user.id}" field="id"></th:block>
                            </div>

                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" class="form-control" field="name" id="name" name="name" th:value="${user.name}">
                            </div>
                            <div class="form-group">
                                <label for="salary">Salary</label>
                                <input type="number" class="form-control" field="salary" id="salary" name="salary" th:value="${user.salary}">
                            </div>
                            <div class="form-group">
                                <label for="age">Age</label>
                                <input type="number" class="form-control" field="age" id="age" name="age" th:value="${user.age}">
                            </div>
                        <div class="form-group">
                            <label for="password"></label>
                            <input hidden="hidden" type="text" class="form-control" field="password" id="password" name="password" th:value="${user.password}">
                        </div>
                            <div class="form-group">
                                <label for="username">Email</label>
                                <input type="text" class="form-control" field="username" id="username" name="username" th:value="${user.username}">
                            </div>

                        <label th:for="${'rolesEdit' + user.id}">Roles</label>
                            <select class="custom-select" th:id="${'rolesEdit' + user.id}" name="roles" multiple>
                                <option th:each="role:${allRoles}" th:text="${role.roleName}" th:value="${role.id}" th:selected="${user.userRoles.contains(role)}">
                            </select>
                    </div>
                    <div class="modal-footer">
                        <input class="btn btn-primary"
                               type="submit"
                               value="Update"/>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        </form>
    </td>
    <td>
        <button type="button" class="btn btn-danger" data-toggle="modal" th:action="@{/admin/removeUser}" th:method="get" th:attr="data-target='#removeUser-' + ${user.id}">
            Delete
        </button>
    </td>
</tr>
</tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
</div>
</body>
</html>